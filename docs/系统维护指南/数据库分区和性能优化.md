
import useBaseUrl from '@docusaurus/useBaseUrl';

## 概述

* 分区表允许把逻辑上的一个表在物理上分为很多部分。换句话说，分区表从物理上看是将一个大表分成几个小表，但是从逻辑上看，还是一个大表。其种分区就是把一张表的数据分成N个区块，从逻辑上看只是一张表，但底层是由N个物理区块组成的；而分表就是把一张表按一定的规则分解成N个具有独立存储空间的实体表。

* 建议考虑分区表的情况：
  * 当数据库中某个表的数据量很大，在查询数据时会明显感觉到速度很慢
  * 数据是分段的，如以年份为分隔的数据，对于当前的数据经常进行增删改查操作，而对于往年的数据几乎不做操作或只做查询操作
  * 对数据的操作如果只涉及一部分数据而非全部数据

* 不建议考虑分区表的情况：
  * 如果一张表的数据经常进行增删改查操作，而不管年份之类的因素，这种情况最好不要考虑分区表

* 使用多个文件分布数据到多个硬盘中，可以极大地提高IO性能。多个文件对于数据略多的数据库来说，备份和恢复都会轻松很多。

## SQL Server数据库

### 创建步骤

* 创建分表区的步骤分为5步：

  * 创建数据库文件组

  * 创建数据库文件
  
  注：应将文件组和文件存放于不同的硬盘甚至不同的服务器中，因为数据的读取瓶颈很大程度在于硬盘的读写速度，多个硬盘存储一个表可以实现负载均衡。

  * 创建分区函数

  注：声明分区的标准。

4）创建分区方案

注：即哪些区域使用哪个分区函数，形成完整的分区方案。

5）创建分区表

### 实现过程

* 首先查询一下表的大小占用

```
select schema_name(t.schema_id) as [Schema], t.name as TableName,i.rows as [RowCount]
from sys.tables as t, sysindexes as i
where t.object_id = i.id and i.indid <=1 order by rows DESC
```

<img alt=" " src={useBaseUrl('docimg/分区表4201.png')} />

* 新建文件组：H_Ext_KPI，H_Ext_Tag，H_Ext_Task, AssetProperty, TaskGroupSequence各建16个文件组

```
alter database <数据库名> add filegroup <文件组名>

---------------------------------------------

alter database imgenius add filegroup ExtTag1
alter database imgenius add filegroup ExtTag2
alter database imgenius add filegroup ExtTag3
alter database imgenius add filegroup ExtTag4
alter database imgenius add filegroup ExtTag5
alter database imgenius add filegroup ExtTag6
alter database imgenius add filegroup ExtTag7
alter database imgenius add filegroup ExtTag8
alter database imgenius add filegroup ExtTag9
alter database imgenius add filegroup ExtTag10
alter database imgenius add filegroup ExtTag11
alter database imgenius add filegroup ExtTag12
alter database imgenius add filegroup ExtTag13
alter database imgenius add filegroup ExtTag14
alter database imgenius add filegroup ExtTag15
alter database imgenius add filegroup ExtTag16

---------------------------------------------

alter database imgenius add filegroup ExtTask1
alter database imgenius add filegroup ExtTask2
alter database imgenius add filegroup ExtTask3
alter database imgenius add filegroup ExtTask4
alter database imgenius add filegroup ExtTask5
alter database imgenius add filegroup ExtTask6
alter database imgenius add filegroup ExtTask7
alter database imgenius add filegroup ExtTask8
alter database imgenius add filegroup ExtTask9
alter database imgenius add filegroup ExtTask10
alter database imgenius add filegroup ExtTask11
alter database imgenius add filegroup ExtTask12
alter database imgenius add filegroup ExtTask13
alter database imgenius add filegroup ExtTask14
alter database imgenius add filegroup ExtTask15
alter database imgenius add filegroup ExtTask16

---------------------------------------------

alter database imgenius add filegroup ExtKPI1
alter database imgenius add filegroup ExtKPI2
alter database imgenius add filegroup ExtKPI3
alter database imgenius add filegroup ExtKPI4
alter database imgenius add filegroup ExtKPI5
alter database imgenius add filegroup ExtKPI6
alter database imgenius add filegroup ExtKPI7
alter database imgenius add filegroup ExtKPI8
alter database imgenius add filegroup ExtKPI9
alter database imgenius add filegroup ExtKPI10
alter database imgenius add filegroup ExtKPI11
alter database imgenius add filegroup ExtKPI12
alter database imgenius add filegroup ExtKPI13
alter database imgenius add filegroup ExtKPI14
alter database imgenius add filegroup ExtKPI15
alter database imgenius add filegroup ExtKPI16

----------------------------------------------------

alter database imgenius add filegroup AssetProperty1
alter database imgenius add filegroup AssetProperty2
alter database imgenius add filegroup AssetProperty3
alter database imgenius add filegroup AssetProperty4
alter database imgenius add filegroup AssetProperty5
alter database imgenius add filegroup AssetProperty6
alter database imgenius add filegroup AssetProperty7
alter database imgenius add filegroup AssetProperty8
alter database imgenius add filegroup AssetProperty9
alter database imgenius add filegroup AssetProperty10
alter database imgenius add filegroup AssetProperty11
alter database imgenius add filegroup AssetProperty12
alter database imgenius add filegroup AssetProperty13
alter database imgenius add filegroup AssetProperty14
alter database imgenius add filegroup AssetProperty15
alter database imgenius add filegroup AssetProperty16

--------------------------------------------------------

alter database imgenius add filegroup TaskGroupSequence1
alter database imgenius add filegroup TaskGroupSequence2
alter database imgenius add filegroup TaskGroupSequence3
alter database imgenius add filegroup TaskGroupSequence4
alter database imgenius add filegroup TaskGroupSequence5
alter database imgenius add filegroup TaskGroupSequence6
alter database imgenius add filegroup TaskGroupSequence7
alter database imgenius add filegroup TaskGroupSequence8
alter database imgenius add filegroup TaskGroupSequence9
alter database imgenius add filegroup TaskGroupSequence10
alter database imgenius add filegroup TaskGroupSequence11
alter database imgenius add filegroup TaskGroupSequence12
alter database imgenius add filegroup TaskGroupSequence13
alter database imgenius add filegroup TaskGroupSequence14
alter database imgenius add filegroup TaskGroupSequence15
alter database imgenius add filegroup TaskGroupSequence16
```

* 新建文件

```
alter database imgenius add file 
(name=N'KPI1',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\KPI1.ndf',size=5Mb,filegrowth=5mb)
to filegroup ExtKPI1
alter database imgenius add file 
(name=N'KPI2',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\KPI2.ndf',size=5Mb,filegrowth=5mb)
to filegroup ExtKPI2
alter database imgenius add file 
(name=N'KPI3',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\KPI3.ndf',size=5Mb,filegrowth=5mb)
to filegroup ExtKPI3
alter database imgenius add file 
(name=N'KPI4',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\KPI4.ndf',size=5Mb,filegrowth=5mb)
to filegroup ExtKPI4
alter database imgenius add file 
(name=N'KPI5',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\KPI5.ndf',size=5Mb,filegrowth=5mb)
to filegroup ExtKPI5
alter database imgenius add file 
(name=N'KPI6',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\KPI6.ndf',size=5Mb,filegrowth=5mb)
to filegroup ExtKPI6
alter database imgenius add file 
(name=N'KPI7',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\KPI7.ndf',size=5Mb,filegrowth=5mb)
to filegroup ExtKPI7
alter database imgenius add file 
(name=N'KPI8',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\KPI8.ndf',size=5Mb,filegrowth=5mb)
to filegroup ExtKPI8
alter database imgenius add file 
(name=N'KPI9',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\KPI9.ndf',size=5Mb,filegrowth=5mb)
to filegroup ExtKPI9
alter database imgenius add file 
(name=N'KPI10',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\KPI10.ndf',size=5Mb,filegrowth=5mb)
to filegroup ExtKPI10
alter database imgenius add file 
(name=N'KPI11',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\KPI11.ndf',size=5Mb,filegrowth=5mb)
to filegroup ExtKPI11
alter database imgenius add file 
(name=N'KPI12',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\KPI12.ndf',size=5Mb,filegrowth=5mb)
to filegroup ExtKPI12
alter database imgenius add file 
(name=N'KPI13',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\KPI13.ndf',size=5Mb,filegrowth=5mb)
to filegroup ExtKPI13
alter database imgenius add file 
(name=N'KPI14',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\KPI14.ndf',size=5Mb,filegrowth=5mb)
to filegroup ExtKPI14
alter database imgenius add file 
(name=N'KPI15',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\KPI15.ndf',size=5Mb,filegrowth=5mb)
to filegroup ExtKPI15
alter database imgenius add file 
(name=N'KPI16',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\KPI16.ndf',size=5Mb,filegrowth=5mb)
to filegroup ExtKPI16

-----------------------------------------------------------------------------------------------------------------

alter database imgenius add file 
(name=N'TASK1',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\TASK1.ndf',size=5Mb,filegrowth=5mb)
to filegroup ExtTask1
alter database imgenius add file 
(name=N'TASK2',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\TASK2.ndf',size=5Mb,filegrowth=5mb)
to filegroup ExtTask2
alter database imgenius add file 
(name=N'TASK3',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\TASK3.ndf',size=5Mb,filegrowth=5mb)
to filegroup ExtTask3
alter database imgenius add file 
(name=N'TASK4',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\TASK4.ndf',size=5Mb,filegrowth=5mb)
to filegroup ExtTask4
alter database imgenius add file 
(name=N'TASK5',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\TASK5.ndf',size=5Mb,filegrowth=5mb)
to filegroup ExtTask5
alter database imgenius add file 
(name=N'TASK6',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\TASK6.ndf',size=5Mb,filegrowth=5mb)
to filegroup ExtTask6
alter database imgenius add file 
(name=N'TASK7',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\TASK7.ndf',size=5Mb,filegrowth=5mb)
to filegroup ExtTask7
alter database imgenius add file 
(name=N'TASK8',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\TASK8.ndf',size=5Mb,filegrowth=5mb)
to filegroup ExtTask8
alter database imgenius add file 
(name=N'TASK9',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\TASK9.ndf',size=5Mb,filegrowth=5mb)
to filegroup ExtTask9
alter database imgenius add file 
(name=N'TASK10',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\TASK10.ndf',size=5Mb,filegrowth=5mb)
to filegroup ExtTask10
alter database imgenius add file 
(name=N'TASK11',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\TASK11.ndf',size=5Mb,filegrowth=5mb)
to filegroup ExtTask11
alter database imgenius add file 
(name=N'TASK12',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\TASK12.ndf',size=5Mb,filegrowth=5mb)
to filegroup ExtTask12
alter database imgenius add file 
(name=N'TASK13',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\TASK13.ndf',size=5Mb,filegrowth=5mb)
to filegroup ExtTask13
alter database imgenius add file 
(name=N'TASK14',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\TASK14.ndf',size=5Mb,filegrowth=5mb)
to filegroup ExtTask14
alter database imgenius add file 
(name=N'TASK15',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\TASK15.ndf',size=5Mb,filegrowth=5mb)
to filegroup ExtTask15
alter database imgenius add file 
(name=N'TASK16',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\TASK16.ndf',size=5Mb,filegrowth=5mb)
to filegroup ExtTask16

-----------------------------------------------------------------------------------------------------------------

alter database imgenius add file 
(name=N'TAG1',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\TAG1.ndf',size=5Mb,filegrowth=5mb)
to filegroup ExtTag1
alter database imgenius add file 
(name=N'TAG2',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\TAG2.ndf',size=5Mb,filegrowth=5mb)
to filegroup ExtTag2
alter database imgenius add file 
(name=N'TAG3',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\TAG3.ndf',size=5Mb,filegrowth=5mb)
to filegroup ExtTag3
alter database imgenius add file 
(name=N'TAG4',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\TAG4.ndf',size=5Mb,filegrowth=5mb)
to filegroup ExtTag4
alter database imgenius add file 
(name=N'TAG5',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\TAG5.ndf',size=5Mb,filegrowth=5mb)
to filegroup ExtTag5
alter database imgenius add file 
(name=N'TAG6',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\TAG6.ndf',size=5Mb,filegrowth=5mb)
to filegroup ExtTag6
alter database imgenius add file 
(name=N'TAG7',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\TAG7.ndf',size=5Mb,filegrowth=5mb)
to filegroup ExtTag7
alter database imgenius add file 
(name=N'TAG8',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\TAG8.ndf',size=5Mb,filegrowth=5mb)
to filegroup ExtTag8
alter database imgenius add file 
(name=N'TAG9',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\TAG9.ndf',size=5Mb,filegrowth=5mb)
to filegroup ExtTag9
alter database imgenius add file 
(name=N'TAG10',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\TAG10.ndf',size=5Mb,filegrowth=5mb)
to filegroup ExtTag10
alter database imgenius add file 
(name=N'TAG11',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\TAG11.ndf',size=5Mb,filegrowth=5mb)
to filegroup ExtTag11
alter database imgenius add file 
(name=N'TAG12',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\TAG12.ndf',size=5Mb,filegrowth=5mb)
to filegroup ExtTag12
alter database imgenius add file 
(name=N'TAG13',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\TAG13.ndf',size=5Mb,filegrowth=5mb)
to filegroup ExtTag13
alter database imgenius add file 
(name=N'TAG14',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\TAG14.ndf',size=5Mb,filegrowth=5mb)
to filegroup ExtTag14
alter database imgenius add file 
(name=N'TAG15',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\TAG15.ndf',size=5Mb,filegrowth=5mb)
to filegroup ExtTag15
alter database imgenius add file 
(name=N'TAG16',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\TAG16.ndf',size=5Mb,filegrowth=5mb)
to filegroup ExtTag16

-----------------------------------------------------------------------------------------------------------------

alter database imgenius add file 
(name=N'ASSETPROPERTY1',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\ASSETPROPERTY1.ndf',size=5Mb,filegrowth=5mb)
to filegroup AssetProperty1
alter database imgenius add file 
(name=N'ASSETPROPERTY2',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\ASSETPROPERTY2.ndf',size=5Mb,filegrowth=5mb)
to filegroup AssetProperty2
alter database imgenius add file 
(name=N'ASSETPROPERTY3',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\ASSETPROPERTY3.ndf',size=5Mb,filegrowth=5mb)
to filegroup AssetProperty3
alter database imgenius add file 
(name=N'ASSETPROPERTY4',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\ASSETPROPERTY4.ndf',size=5Mb,filegrowth=5mb)
to filegroup AssetProperty4
alter database imgenius add file 
(name=N'ASSETPROPERTY5',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\ASSETPROPERTY5.ndf',size=5Mb,filegrowth=5mb)
to filegroup AssetProperty5
alter database imgenius add file 
(name=N'ASSETPROPERTY6',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\ASSETPROPERTY6.ndf',size=5Mb,filegrowth=5mb)
to filegroup AssetProperty6
alter database imgenius add file 
(name=N'ASSETPROPERTY7',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\ASSETPROPERTY7.ndf',size=5Mb,filegrowth=5mb)
to filegroup AssetProperty7
alter database imgenius add file 
(name=N'ASSETPROPERTY8',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\ASSETPROPERTY8.ndf',size=5Mb,filegrowth=5mb)
to filegroup AssetProperty8
alter database imgenius add file 
(name=N'ASSETPROPERTY9',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\ASSETPROPERTY9.ndf',size=5Mb,filegrowth=5mb)
to filegroup AssetProperty9
alter database imgenius add file 
(name=N'ASSETPROPERTY10',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\ASSETPROPERTY10.ndf',size=5Mb,filegrowth=5mb)
to filegroup AssetProperty10
alter database imgenius add file 
(name=N'ASSETPROPERTY11',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\ASSETPROPERTY11.ndf',size=5Mb,filegrowth=5mb)
to filegroup AssetProperty11
alter database imgenius add file 
(name=N'ASSETPROPERTY12',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\ASSETPROPERTY12.ndf',size=5Mb,filegrowth=5mb)
to filegroup AssetProperty12
alter database imgenius add file 
(name=N'ASSETPROPERTY13',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\ASSETPROPERTY13.ndf',size=5Mb,filegrowth=5mb)
to filegroup AssetProperty13
alter database imgenius add file 
(name=N'ASSETPROPERTY14',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\ASSETPROPERTY14.ndf',size=5Mb,filegrowth=5mb)
to filegroup AssetProperty14
alter database imgenius add file 
(name=N'ASSETPROPERTY15',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\ASSETPROPERTY15.ndf',size=5Mb,filegrowth=5mb)
to filegroup AssetProperty15
alter database imgenius add file 
(name=N'ASSETPROPERTY16',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\ASSETPROPERTY16.ndf',size=5Mb,filegrowth=5mb)
to filegroup AssetProperty16

-----------------------------------------------------------------------------------------------------------------

alter database imgenius add file 
(name=N'TASKGROUPSEQUENCE1',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\TASKGROUPSEQUENCE1.ndf',size=5Mb,filegrowth=5mb)
to filegroup Taskgroupsequence1
alter database imgenius add file 
(name=N'TASKGROUPSEQUENCE2',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\TASKGROUPSEQUENCE2.ndf',size=5Mb,filegrowth=5mb)
to filegroup Taskgroupsequence2
alter database imgenius add file 
(name=N'TASKGROUPSEQUENCE3',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\TASKGROUPSEQUENCE3.ndf',size=5Mb,filegrowth=5mb)
to filegroup Taskgroupsequence3
alter database imgenius add file 
(name=N'TASKGROUPSEQUENCE4',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\TASKGROUPSEQUENCE4.ndf',size=5Mb,filegrowth=5mb)
to filegroup Taskgroupsequence4
alter database imgenius add file 
(name=N'TASKGROUPSEQUENCE5',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\TASKGROUPSEQUENCE5.ndf',size=5Mb,filegrowth=5mb)
to filegroup Taskgroupsequence5
alter database imgenius add file 
(name=N'TASKGROUPSEQUENCE6',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\TASKGROUPSEQUENCE6.ndf',size=5Mb,filegrowth=5mb)
to filegroup Taskgroupsequence6
alter database imgenius add file 
(name=N'TASKGROUPSEQUENCE7',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\TASKGROUPSEQUENCE7.ndf',size=5Mb,filegrowth=5mb)
to filegroup Taskgroupsequence7
alter database imgenius add file 
(name=N'TASKGROUPSEQUENCE8',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\TASKGROUPSEQUENCE8.ndf',size=5Mb,filegrowth=5mb)
to filegroup Taskgroupsequence8
alter database imgenius add file 
(name=N'TASKGROUPSEQUENCE9',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\TASKGROUPSEQUENCE9.ndf',size=5Mb,filegrowth=5mb)
to filegroup Taskgroupsequence9
alter database imgenius add file 
(name=N'TASKGROUPSEQUENCE10',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\TASKGROUPSEQUENCE10.ndf',size=5Mb,filegrowth=5mb)
to filegroup Taskgroupsequence10
alter database imgenius add file 
(name=N'TASKGROUPSEQUENCE11',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\TASKGROUPSEQUENCE11.ndf',size=5Mb,filegrowth=5mb)
to filegroup Taskgroupsequence11
alter database imgenius add file 
(name=N'TASKGROUPSEQUENCE12',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\TASKGROUPSEQUENCE12.ndf',size=5Mb,filegrowth=5mb)
to filegroup Taskgroupsequence12
alter database imgenius add file 
(name=N'TASKGROUPSEQUENCE13',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\TASKGROUPSEQUENCE13.ndf',size=5Mb,filegrowth=5mb)
to filegroup Taskgroupsequence13
alter database imgenius add file 
(name=N'TASKGROUPSEQUENCE14',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\TASKGROUPSEQUENCE14.ndf',size=5Mb,filegrowth=5mb)
to filegroup Taskgroupsequence14
alter database imgenius add file 
(name=N'TASKGROUPSEQUENCE15',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\TASKGROUPSEQUENCE15.ndf',size=5Mb,filegrowth=5mb)
to filegroup Taskgroupsequence15
alter database imgenius add file 
(name=N'TASKGROUPSEQUENCE16',filename=N'D:\WorkSoftWare\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\TASKGROUPSEQUENCE16.ndf',size=5Mb,filegrowth=5mb)
to filegroup Taskgroupsequence16
```

* 创建分区函数

```
USE [imgenius]
GO
BEGIN TRANSACTION
CREATE PARTITION FUNCTION [task](datetime) AS RANGE LEFT FOR VALUES (N'2014-04-01T00:00:00', N'2014-07-01T00:00:00', N'2014-10-01T00:00:00', N'2015-01-01T00:00:00', N'2015-04-01T00:00:00', N'2015-07-01T00:00:00', N'2015-10-01T00:00:00', N'2016-01-01T00:00:00', N'2016-04-01T00:00:00', N'2016-07-01T00:00:00', N'2016-10-01T00:00:00', N'2017-01-01T00:00:00', N'2017-04-01T00:00:00', N'2017-07-01T00:00:00', N'2017-10-01T00:00:00', N'2018-01-01T00:00:00')
```

* 创建分区方案

```
CREATE PARTITION SCHEME [task] AS PARTITION [task] TO ([ExtTask1], [ExtTask2], [ExtTask3], [ExtTask4], [ExtTask5], [ExtTask6], [ExtTask7], [ExtTask8], [ExtTask9], [ExtTask10], [ExtTask11], [ExtTask12], [ExtTask13], [ExtTask14], [ExtTask15], [ExtTask16], [ExtTask16])
```

* 创建分区表

```
ALTER TABLE [dbo].[H_Ext_Task] DROP CONSTRAINT [PK_H_Ext_Task]


ALTER TABLE [dbo].[H_Ext_Task] ADD  CONSTRAINT [PK_H_Ext_Task] PRIMARY KEY NONCLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, FILLFACTOR = 85) ON [PRIMARY]


CREATE CLUSTERED INDEX [ClusteredIndex_on_task_636451430433511873] ON [dbo].[H_Ext_Task]
(
	[StartTime]
)WITH (SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF) ON [task]([StartTime])


DROP INDEX [ClusteredIndex_on_task_636451430433511873] ON [dbo].[H_Ext_Task]


COMMIT TRANSACTION
```

```
-----------------------------------------------------------------------------------------------------------------------
tag
-----------------------------------------------------------------------------------------------------------------------
USE [imgenius]
GO
BEGIN TRANSACTION
CREATE PARTITION FUNCTION [tag](datetime) AS RANGE LEFT FOR VALUES (N'2014-04-01T00:00:00', N'2014-07-01T00:00:00', N'2014-10-01T00:00:00', N'2015-01-01T00:00:00', N'2015-04-01T00:00:00', N'2015-07-01T00:00:00', N'2015-10-01T00:00:00', N'2016-01-01T00:00:00', N'2016-04-01T00:00:00', N'2016-07-01T00:00:00', N'2016-10-01T00:00:00', N'2017-01-01T00:00:00', N'2017-04-01T00:00:00', N'2017-07-01T00:00:00', N'2017-10-01T00:00:00', N'2018-01-01T00:00:00')


CREATE PARTITION SCHEME [tag] AS PARTITION [tag] TO ([ExtTag1], [ExtTag2], [ExtTag3], [ExtTag4], [ExtTag5], [ExtTag6], [ExtTag7], [ExtTag8], [ExtTag9], [ExtTag10], [ExtTag11], [ExtTag12], [ExtTag13], [ExtTag14], [ExtTag15], [ExtTag16], [ExtTag16])


ALTER TABLE [dbo].[H_Ext_Tag] DROP CONSTRAINT [PK_H_Ext_Tag]


ALTER TABLE [dbo].[H_Ext_Tag] ADD  CONSTRAINT [PK_H_Ext_Tag] PRIMARY KEY NONCLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, FILLFACTOR = 85) ON [PRIMARY]


CREATE CLUSTERED INDEX [ClusteredIndex_on_tag_636451432890267524] ON [dbo].[H_Ext_Tag]
(
	[InputTime]
)WITH (SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF) ON [tag]([InputTime])


DROP INDEX [ClusteredIndex_on_tag_636451432890267524] ON [dbo].[H_Ext_Tag]

COMMIT TRANSACTION


-----------------------------------------------------------------------------------------------------------------------
H_AssetProperty
-----------------------------------------------------------------------------------------------------------------------
USE [imgenius]
GO
BEGIN TRANSACTION
CREATE PARTITION FUNCTION [asset](datetime) AS RANGE LEFT FOR VALUES (N'2014-04-01T00:00:00', N'2014-07-01T00:00:00', N'2014-10-01T00:00:00', N'2015-01-01T00:00:00', N'2015-04-01T00:00:00', N'2015-07-01T00:00:00', N'2015-10-01T00:00:00', N'2016-01-01T00:00:00', N'2016-04-01T00:00:00', N'2016-07-01T00:00:00', N'2016-10-01T00:00:00', N'2017-01-01T00:00:00', N'2017-04-01T00:00:00', N'2017-07-01T00:00:00', N'2017-10-01T00:00:00', N'2018-01-01T00:00:00')


CREATE PARTITION SCHEME [asset] AS PARTITION [asset] TO ([AssetProperty1], [AssetProperty2], [AssetProperty3], [AssetProperty4], [AssetProperty5], [AssetProperty6], [AssetProperty7], [AssetProperty8], [AssetProperty9], [AssetProperty10], [AssetProperty11], [AssetProperty12], [AssetProperty13], [AssetProperty14], [AssetProperty15], [AssetProperty16], [AssetProperty16])


ALTER TABLE [dbo].[H_AssetProperty] DROP CONSTRAINT [PK_H_AssetProperty]


ALTER TABLE [dbo].[H_AssetProperty] ADD  CONSTRAINT [PK_H_AssetProperty] PRIMARY KEY NONCLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, FILLFACTOR = 85) ON [PRIMARY]


CREATE CLUSTERED INDEX [ClusteredIndex_on_asset_636451436077176183] ON [dbo].[H_AssetProperty]
(
	[ModifyValueOn]
)WITH (SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF) ON [asset]([ModifyValueOn])


DROP INDEX [ClusteredIndex_on_asset_636451436077176183] ON [dbo].[H_AssetProperty]

COMMIT TRANSACTION


-----------------------------------------------------------------------------------------------------------------------
H_TaskGroupSequence
-----------------------------------------------------------------------------------------------------------------------
USE [imgenius]
GO
BEGIN TRANSACTION
CREATE PARTITION FUNCTION [taskgroup](datetime) AS RANGE LEFT FOR VALUES (N'2014-04-01T00:00:00', N'2014-07-01T00:00:00', N'2014-10-01T00:00:00', N'2015-01-01T00:00:00', N'2015-04-01T00:00:00', N'2015-07-01T00:00:00', N'2015-10-01T00:00:00', N'2016-01-01T00:00:00', N'2016-04-01T00:00:00', N'2016-07-01T00:00:00', N'2016-10-01T00:00:00', N'2017-01-01T00:00:00', N'2017-04-01T00:00:00', N'2017-07-01T00:00:00', N'2017-10-01T00:00:00', N'2018-01-01T00:00:00')


CREATE PARTITION SCHEME [taskgroup] AS PARTITION [taskgroup] TO ([TaskGroupSequence1], [TaskGroupSequence2], [TaskGroupSequence3], [TaskGroupSequence4], [TaskGroupSequence5], [TaskGroupSequence6], [TaskGroupSequence7], [TaskGroupSequence8], [TaskGroupSequence9], [TaskGroupSequence10], [TaskGroupSequence11], [TaskGroupSequence12], [TaskGroupSequence13], [TaskGroupSequence13], [TaskGroupSequence14], [TaskGroupSequence15], [TaskGroupSequence16])


ALTER TABLE [dbo].[H_TaskGroupSequence] DROP CONSTRAINT [PK_H_TaskGroupSequence]


ALTER TABLE [dbo].[H_TaskGroupSequence] ADD  CONSTRAINT [PK_H_TaskGroupSequence] PRIMARY KEY NONCLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, FILLFACTOR = 85) ON [PRIMARY]


CREATE CLUSTERED INDEX [ClusteredIndex_on_taskgroup_636451439906119039] ON [dbo].[H_TaskGroupSequence]
(
	[DateTime]
)WITH (SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF) ON [taskgroup]([DateTime])


DROP INDEX [ClusteredIndex_on_taskgroup_636451439906119039] ON [dbo].[H_TaskGroupSequence]


COMMIT TRANSACTION
```

### 分区表检查

* 检查分区函数与分区方案

  <img alt=" " src={useBaseUrl('docimg/分区表4202.png')} />

* 检查分区文件

  <img alt=" " src={useBaseUrl('docimg/分区表4203.png')} />

### 分区表查询

```
SELECT CONVERT(VARCHAR(50),A.NAME) Partition_Scheme, D.Partition_Number, CONVERT(VARCHAR(10),E.NAME) FileGroup,
       CONVERT(VARCHAR(19),ISNULL(G.VALUE,''),120) Range_Boundary,STR(D.ROWS,9) Rows
FROM SYS.PARTITION_SCHEMES A INNER JOIN SYS.DESTINATION_DATA_SPACES B ON A.DATA_SPACE_ID = B.PARTITION_SCHEME_ID
    INNER JOIN SYS.INDEXES C ON A.DATA_SPACE_ID = C.DATA_SPACE_ID
    INNER JOIN SYS.PARTITIONS D ON B.DESTINATION_ID = D.PARTITION_NUMBER AND C.OBJECT_ID=D.OBJECT_ID AND C.INDEX_ID=D.INDEX_ID
    INNER JOIN SYS.DATA_SPACES E ON B.DATA_SPACE_ID = E.DATA_SPACE_ID
    INNER JOIN SYS.PARTITION_FUNCTIONS F ON A.FUNCTION_ID = F.FUNCTION_ID
    LEFT JOIN SYS.PARTITION_RANGE_VALUES G ON F.FUNCTION_ID = G.FUNCTION_ID AND D.PARTITION_NUMBER-F.BOUNDARY_VALUE_ON_RIGHT = G.BOUNDARY_ID
WHERE C.OBJECT_ID = OBJECT_ID('H_Ext_KPI')    --分区表名
    AND C.INDEX_ID IN (0,1)
ORDER BY Partition_Scheme,D.Partition_Number
```

<img alt=" " src={useBaseUrl('docimg/分区表4204.png')} />

* 查看文件及文件组

```
SELECT A.[NAME],A.PHYSICAL_NAME,A.[SIZE],A.GROWTH,B.[NAME] [FILEGROUP],B.IS_DEFAULT
FROM SYS.DATABASE_FILES A 
INNER JOIN SYS.FILEGROUPS B ON A.DATA_SPACE_ID = B.DATA_SPACE_ID
```

<img alt=" " src={useBaseUrl('docimg/分区表4205.png')} />

* 对于文件和文件组的备份请参考：[备份文件和文件组](https://learn.microsoft.com/zh-cn/SQL/relational-databases/backup-restore/back-up-files-and-filegroups-sql-server?view=sql-server-2017)

* 对于文件和文件组的还原请参考：[还原文件和文件组](https://learn.microsoft.com/zh-cn/sql/relational-databases/backup-restore/restore-files-and-filegroups-sql-server?view=sql-server-2017)

## PGSQL数据库