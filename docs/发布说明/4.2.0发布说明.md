
import useBaseUrl from '@docusaurus/useBaseUrl';

发布时间：待发布

## 增加的功能

1. [PBIN3876：打印页面支持自定义](#pbin3876打印页面支持自定义)
1. [PBIN3881：项目每个活动完成时，显示项目属性，对于必填项要求填写才能完成](#pbin3881项目每个活动完成时显示项目属性对于必填项要求填写才能完成)
1. [PBIN3883：内置自定义KPI支持作业、作业项和维度来源](#pbin3883内置自定义kpi支持作业作业项和维度来源)
1. [PBIN3903：终端和Web端内置库操作自定义属性支持各种配置](#pbin3903终端和web端内置库操作自定义属性支持各种配置)
1. [PBIN3913：作业组Word和Excel视图支持显示列表的全部项](#pbin3913作业组word和excel视图支持显示列表的全部项)
1. [PBIN3932：终端旧样式主页和新样式执行列表页扫描后，如果选中未接受的作业组，跳转到当前作业组并选中](#pbin3932终端旧样式主页和新样式执行列表页扫描后如果选中未接受的作业组跳转到当前作业组并选中)
1. [PBIN4004：项目甘特图上显示实际开始时间和预计结束时间标记](#pbin4004项目甘特图上显示实际开始时间和预计结束时间标记)
1. [PBIN4011：资产总览Tab页支持扩展](#pbin4011资产总览tab页支持扩展)
1. [PBIN4025：作业项（历史）报表支持没有选择项](#pbin4025作业项历史报表支持没有选择项)
1. [PBIN4088：库存功能完善](#pbin4088库存功能完善)
1. [PBIN4120：对象资质过期天数可发布Mqtt消息](#pbin4120对象资质过期天数可发布mqtt消息)
1. [PBIN4145：终端和网页端部分细节完善](#pbin4145终端和网页端部分细节完善)
1. [PBIN4148：手机端相机扫描支持打开闪光灯](#pbin4148手机端相机扫描支持打开闪光灯)
1. [PBIN4154：手机端拍照支持增加水印（安卓版本）](#pbin4154手机端拍照支持增加水印安卓版本)
1. [PBIN4179：支持把用户设置为超级管理员](#pbin4179支持把用户设置为超级管理员)
1. [PBIN4184：终端待执行和执行中也可以按时间、组织单元名、分组名排序](#pbin4184终端待执行和执行中也可以按时间组织单元名分组名排序)
1. [PBIN4252：imFigure功能增强](#pbin4252imfigure功能增强)
1. [PBIN4257：KPI增加列表维度，以方便自定义KPI使用](#pbin4257kpi增加列表维度以方便自定义kpi使用)
1. [PBIN4269：统一的Web配置和管理中心](#pbin4269统一的web配置和管理中心)

## 修复的问题

1. BugN3892：EOC库存表库操作，入库增加项信息会提示“项信息重复”
1. BugN3895：EOC计划中作业组属性为库操作，通过导入时，不显示其它相关属性值
1. BugN3896：终端JSON类型作业项后插会触发下一步
1. BugN3900：使用脚本更新作业组属性值，列表类型的属性不会实时显示更新
1. BugN3905：在有些终端设备上图片预览不正确
1. BugN3947：EOC的资产属性为文件类型，值为字符串，会导致页面一直显示加载中
1. BugN3991：网页端资产和用户页面权限控制不正确
1. BugN4023：当启用记录访问日志，在网页端查看自己最近动态将导致消息非常多
1. BugN4040：授权排序规则不同导致终端访问API出现授权错误
1. BugN4042：终端配置显示样式为超链接的JSON类型作业组属性时值不保存
1. BugN4070：消息系统处理太快，有时获取序列失败，从而导致有些消息不会产生
1. BugN4072：JSON格式的通配符在WPS中不显示
1. BugN4113：报表数据量太大，导出文件失败
1. BugN4121：EOC中单个资产的趋势图显示要精确到秒
1. BugN4143：资产属性报表中资产的属性值为空时，窄表模式在主页上显示异常
1. BugN4158：EOC除项目甘特图页面和部分页面的跳转链接外，全屏模式下其余操作均不显示操作框
1. BugN4177：作业项终端显示样式为多行文本时，有换行就无法更新到作业组属性上去
1. BugN4182：JSON类型的作业项，勾选必须完成和不允许为空，在执行时不填写也能标记为完成
1. BugN4183：终端新样式已执行页面，手动删除已执行作业组后，计数气泡显示的数量不变
1. BugN4191：作业组属性报表自定义的字段不支持like查询，需要加%才可以
1. BugN4196：JSON数组类型的作业项值通过逻辑脚本更新到作业组属性中后，在终端上不显示
1. BugN4198：设备报警创建作业组修改作业组名称不正确
1. BugN4200：SQLServer数据库中作业组属性值有英文单引号时无法审核

## 增加的功能详细说明

### PBIN3876：打印页面支持自定义

* 终端打印功能增强，支持自定义打印的页面。此功能需要使用带打印机的终端。需要配置脚本和终端自定义页面。

  <img alt=" " src={useBaseUrl('docimg/dayin4101.png')} />

* 终端自定义页面html例子：

```
{
  "name": "print",
  "beforeShow": "",
  "beforeHide": "",
  "getContent": "function(_context,_cfg){console.log(1263333);var printData=_context.PrintData;var qrCodeText='';var htmls=[];htmls.push('<div style=\"font-size:13px;width: 100%;\">');htmls.push('    <ul style=\"list-style: none;padding:0;margin:0;line-height: 18px;\">');if(printData.BarCodeList&&printData.BarCodeList.length>0){htmls.push('        <li style=\"display:flex;justify-content: space-between;\">');htmls.push('            <div><span>'+printData.BarCodeList[0].Tag+': '+printData.BarCodeList[0].Value+'</span><br/>');htmls.push(' <svg class=\"barcode\" jsbarcode-format=\"CODE128\" jsbarcode-value=\"'+printData.BarCodeList[0].Value+'\" jsbarcode-displayValue=\"false\" jsbarcode-margin=\"0\" jsbarcode-height=\"20\" jsbarcode-width=\"1\"></svg></div>');htmls.push('            <span style=\"margin-top: 5px;font-family:serif;font-style:italic;font-size:30px;\">'+printData.Company+'</span>');htmls.push('        </li>');for(var i=1;i<printData.BarCodeList.length;i++){var _item=printData.BarCodeList[i];if(i%2==1){htmls.push('        <li style=\"display:flex;justify-content: flex-start;\">');var style=_item.Value==100?'width:90px':'width:155px';htmls.push('    <div style=\"'+style+'\">');htmls.push(' <span>'+_item.Tag+': '+_item.Value+'</span><br/>');htmls.push(' <svg class=\"barcode\" jsbarcode-format=\"CODE128\" jsbarcode-value=\"'+_item.Value+'\" jsbarcode-displayValue=\"false\" jsbarcode-margin=\"0\" jsbarcode-height=\"20\" jsbarcode-width=\"1\"></svg>');htmls.push('            </div>')}else{htmls.push(' <div>');htmls.push(' <span>'+_item.Tag+': '+_item.Value+'</span><br/>');htmls.push(' <svg class=\"barcode\" jsbarcode-format=\"CODE128\" jsbarcode-value=\"'+_item.Value+'\" jsbarcode-displayValue=\"false\" jsbarcode-margin=\"0\" jsbarcode-height=\"20\" jsbarcode-width=\"1\"></svg>');htmls.push(' </div>');if(i==printData.BarCodeList.length-1&&printData.QRCodeText){qrCodeText=printData.QRCodeText;htmls.push('        <div class=\"qrCodeImage\" id=\"qrcode\" style=\"margin-left:10px;\"></div>')}htmls.push(' </li>')}}}htmls.push('        <li style=\"display:flex;justify-content: space-between;\">');_.each(printData.PropertyList,function(_item,_index){var style=_index==0?'margin-right:5px;margin-top:5px;':'margin-top:5px;';htmls.push('            <span style=\"'+style+'\">'+_item.PropertyName+': '+_item.PropertyValue+'</span>')});if(printData.BorderValueList&&printData.BorderValueList.length>0){htmls.push('            <span>');_.each(printData.BorderValueList,function(_item,_index){htmls.push('                <span style=\"padding:2px 5px;border: 1px solid #000;margin-left:5px;font-size:15px;\">'+_item+'</span>')});htmls.push('            </span>')}htmls.push(' </li>');htmls.push('    </ul>');htmls.push('</div>');$('#home').html(htmls.join('')).css({'width':'310px','border':'none','height':'200px'});_context.JsBarcode('.barcode').init();if(qrCodeText){_context.MakeQRCodeFunc(qrCodeText,$('#qrcode'),39,39)}}"
}
```

* 作业项脚本例子：

```
var obj = {
    Company:'Mcube',
    BarCodeList:[{
        Value:'MC3416-P',
        Tag:'P/N'
    },{
        Value:'DFR461.04H',
        Tag:'Lot No'
    },{
        Value:'A100003259',
        Tag:'Tracking No.'
    },{
        Value:'2213',
        Tag:'Date Code'
    },{
        Value:'China',
        Tag:'COO'
    },{
        Value:'100',
        Tag:'Quantity'
    },{
        Value:'MC3416-P',
        Tag:'Customer Part No'
    }],
    PropertyList:[{
        'PropertyName':'Pack Date',
        'PropertyValue':'2022/07/22'
    },{
        'PropertyName':'Packer',
        'PropertyValue':'C0015'
    }],
    BorderValueList:['GP','HF'],
    Template:true,
    QRCodeText:'MC3416-P;DFR461.04H;2213;100;A100003259;China;MC3416-P',
    AutoPrint:true
}
Scan.StartPrint(JSON.stringify(obj));
return true;
```

* 效果图：

  <img alt=" " src={useBaseUrl('docimg/dayin4102.png')} />

### PBIN3881：项目每个活动完成时，显示项目属性，对于必填项要求填写才能完成

* 项目功能增强，在每个流程活动完成时，对话框中将显示项目的属性，其中必填项要求填写才可以完成。

  <img alt=" " src={useBaseUrl('docimg/xiangmu4201.png')} />

  <img alt=" " src={useBaseUrl('docimg/xiangmu4202.png')} />

### PBIN3883：内置自定义KPI支持作业、作业项和维度来源

* 内置自定义KPI进一步优化，增加了根据作业，作业项值统计，维度来源支持作业组属性。具体说明如下：

* 配置

  * “config.json”配置样例：

```json
{
  "DimensionList": [
    {
      "DimensionName": "时间"
    },
    {
      "DimensionName": "组织单元"
    },
    {
      "DimensionName": "人员"
    },
    {
      "DimensionName": "例外等级"
    },
    {
      "DimensionName": "作业组"
    },
    {
      "DimensionName": "班次"
    },
    {
      "DimensionName": "业务范畴"
    },
    {
      "DimensionName": "资产",
	  "From":{
		"Type":1,
		"Name":"资产"
	  }
    },
    {
      "DimensionName": "资产类别",
	  "From":{
		"Type":1,
		"Name":"资产类别"
	  }
    }
  ],
  "ChildKPIList": [
  {
      "ChildKPIID": "BJ",
      "ChildKPIName": "北京",
	  "CalculateType":0,
	  "Unit":"个",
	  "Numerator":{
		  "ColName":"TaskSF",
		  "Type":1,
		  "IsCondition":true,
		  "Operator":"=",
		  "Condition":"cef6aa30-6e72-4fdd-a4ab-09a3a473eefd"
	  }
  },
  {
      "ChildKPIID": "BJRate",
      "ChildKPIName": "北京率",
	  "CalculateType":1,
	  "Unit":"%",
	  "Numerator":{
		  "ColName":"TaskSF",
		  "Type":1,
		  "IsCondition":true,
		  "Operator":"=",
		  "Condition":"cef6aa30-6e72-4fdd-a4ab-09a3a473eefd"
	  },
	  "Denominator":{
		"ColName":"TaskSF",
		"Type":1
	  }
    },
  {
      "ChildKPIID": "GfNumber",
      "ChildKPIName": "作业规范1",
	  "CalculateType":0,
	  "Unit":"个",
	  "Numerator":{
	  "ColName":"GFNumber"
	  }
    },
	{
      "ChildKPIID": "GFNumber2",
      "ChildKPIName": "作业规范",
	  "CalculateType":0,
	  "Unit":"个",
	  "Numerator":{
	  "ColName":"GFNumber2"
	  }
    },
    {
      "ChildKPIID": "Number",
      "ChildKPIName": "数量",
	  "CalculateType":0,
	  "Unit":"个",
	  "Numerator":{
	  "ColName":"Number"
	  }
    },
    {
      "ChildKPIID": "Good",
      "ChildKPIName": "好评",
	  "CalculateType":0,
	  "Unit":"条",
	  "Numerator":{
	  "ColName":"Good",
	  "Type":1,
	  "IsCondition":true,
	  "Operator":"=",
	  "Condition":"09A5FA8B-52EE-4C6E-B3CC-29135D38DC8C"
	  }
    },
	{
      "ChildKPIID": "Bad",
      "ChildKPIName": "非好评",
	  "CalculateType":0,
	  "Unit":"条",
	  "Numerator":{
	  "ColName":"Good",
	  "Type":1,
	  "IsCondition":true,
	  "Operator":"<>",
	  "Condition":"09A5FA8B-52EE-4C6E-B3CC-29135D38DC8C"
	  }
    },
	 {
      "ChildKPIID": "GoodRate",
      "ChildKPIName": "好评率",
	  "CalculateType":1,
	  "Unit":"%",
	  "Numerator":{
		  "ColName":"Good",
		  "Type":1,
		  "IsCondition":true,
		  "Operator":"=",
		  "Condition":"09A5FA8B-52EE-4C6E-B3CC-29135D38DC8C"
	  },
	  "Denominator":{
		"ColName":"Good",
		"Type":1
	  }
    },
	 {
      "ChildKPIID": "BadRate",
      "ChildKPIName": "非好评率",
	  "CalculateType":1,
	  "Unit":"%",
	  "Numerator":{
		  "ColName":"Good",
		  "Type":1,
		  "IsCondition":true,
		  "Operator":"<>",
		  "Condition":"09A5FA8B-52EE-4C6E-B3CC-29135D38DC8C"
	  },
	  "Denominator":{
		"ColName":"Good",
		"Type":1
	  }
    }
  ],
  "EtlDatas": [
  {
      "Type": 0,
      "ID": "",
      "Name": "省份",
      "ColName": "TaskSF",
      "DataType": 1
    },
    {
      "Type": 1,
      "ID": "",
      "Name": "数量",
      "ColName": "Number",
      "DataType": 3
    },
    {
      "Type": 1,
      "ID": "",
      "Name": "好评",
      "ColName": "Good",
      "DataType": 1
    },
    {
      "Type": 0,
      "ID": "",
      "Name": "规范数值",
      "ColName": "GFNumber",
      "DataType": 3
    },
    {
      "Type": 0,
      "ID": "",
      "Name": "7867d544-e05c-43b5-b281-378f1ba12fe3",
      "ColName": "GFNumber2",
      "DataType": 3
    }
  ],
  "TableName": "TestNew_new",
  "TableVersion": 1,
  "CustomType": 1,
  "ExtractTime": 1,
  "NeedExtractTaskGroupIDs": "7902b8d2-3f61-4fdf-bea1-6b23bc65933e"
}
```

* 配置说明

```
DimensionList 维度 数组

自定义kpi的维度，当前支持 ‘时间’，‘组织单元’，‘人员’，‘例外等级’，‘资产’，‘作业组’，‘班次’，‘业务范畴’，‘资产类别’；
DimensionName 值必须为当前支持的维度名称
From 维度值来源，缺失值为默认来源
    Type 维度来源类型，1为作业组属性 缺省值0 默认值
    Name 维度来源名称，当前为作业组属性名 Type为0时不起作用
    DimensionName
维度支持默认来源（作业组相关信息），作业组属性
```

```
ChildKPIList 子KPI 数组

ChildKPIID    子KPIID 在同一个配置中为唯一字符串（英文字符串）
ChildKPIName  子KPI名称
CalculateType 子KPI的计算方式，枚举类型；1求和，1求百分率（结果会*100），2求比
Unit  单位
Numerator 分子；如果求和类型则为值，如果为百分率或求比则为分子
  ColName 当前元素在数据库中字段名
  Type 统计方式 枚举类型 0求和，1计数
  IsCondition 是否为条件 bool类型 true则会使用条件查询，false则统计所有
  Operator 条件符号 字符串 支持 =,<>,>,>=,<,<=
  Condition 当前元素的条件 字符串
Denominator 分母；求和类型为空，求百分率或求比为分母 内部元素与Numerator相同
```

```
EtlDatas 抽取数据 数组

Type 数据抽取的来源类型 枚举类型 0作业项值或作业状态，1作业组属性
Name 数据来源名称或者ID 字符串 作业组属性只支持名称，作业项或者作业状态支持ID或者名称（同一个作业组中相同的则随机取值，尽量避免抽取数据在作业组重名或引用相同的作业规范）
ColName 抽取的数据在数据库中的字段名称
DataType 抽取的数据在数据库中的类型 枚举类型 0:未知,Guid=1,String=2,Int=3,TinyInt=31,SmallInt=32,BigInt=33,Double=35,DateTime=4,Bool（bit）=5
```

```
其他配置

TableName 数据库表名称 字符串
TableVersion 表版本号 正整数 注：当同一个数据表的版本号不同时，会重新创建表不兼容旧数据
CustomType 自定义KPI的类型 枚举类型 0独立部署 缺省值 ，1内部扩展kpi
ExtractTime 抽取时间 枚举类型 0 不抽取，1作业组执行完后
NeedExtractTaskGroupIDs 需要抽取的作业组模板ID列表 字符串 多个则使用','分割
```

* 在系统扩展管理中添加自定义KPI

  <img alt=" " src={useBaseUrl('docimg/kpi4101.png')} />

### PBIN3903：终端和Web端内置库操作自定义属性支持各种配置

* 内置库操作功能优化，终端和Web端内置库操作自定义属性支持各种配置，显示也与SDC中配置类型显示一致。

  <img alt=" " src={useBaseUrl('docimg/kucaozuo4201.png')} />

  <img alt=" " src={useBaseUrl('docimg/kucaozuo4202.png')} />

  <img alt=" " src={useBaseUrl('docimg/kucaozuo4203.png')} />

### PBIN3913：作业组Word和Excel视图支持显示列表的全部项

* 作业树模板显示功能增强，增加了listvalue通配符，支持就地显示列表的所有列表项。Word和Excel视图中显示列表的全部项，列表值之间用空格分隔，选择项值的前方带有已勾选的框。

* 举例下图中作业组属性"无凝露"的数据类型为列表，在之前的版本中，如果希望在Word中显示，那么word模板通配符是写为$im.tg.a.无凝露.value.e$，生成的word视图也只显示选择了的内容

  <img alt=" " src={useBaseUrl('docimg/tongpeifu4201.png')} />

* 而在新版本中，如果希望将列表的全部项都显示出来，并且对于选择和未选择的项有明显区分，那么将value写为listvalue即可，如$im.tg.a.无凝露.listvalue.e$。效果如图：

  <img alt=" " src={useBaseUrl('docimg/tongpeifu4202.png')} />

### PBIN3932：终端旧样式主页和新样式执行列表页扫描后，如果选中未接受的作业组，跳转到当前作业组并选中

* 终端扫描功能优化，在旧样式主页和新样式执行列表页扫描后，如果选中未接受的作业组，也可以跳转到当前作业组并选中。

  <img alt=" " src={useBaseUrl('docimg/saomiao4201.png')} />

  <img alt=" " src={useBaseUrl('docimg/saomiao4202.png')} />

### PBIN4004：项目甘特图上显示实际开始时间和预计结束时间标记

### PBIN4011：资产总览Tab页支持扩展

### PBIN4025：作业项（历史）报表支持没有选择项

### PBIN4088：库存功能完善

### PBIN4120：对象资质过期天数可发布Mqtt消息

### PBIN4145：终端和网页端部分细节完善

### PBIN4148：手机端相机扫描支持打开闪光灯

### PBIN4154：手机端拍照支持增加水印（安卓版本）

### PBIN4179：支持把用户设置为超级管理员

### PBIN4184：终端待执行和执行中也可以按时间、组织单元名、分组名排序

### PBIN4252：imFigure功能增强

### PBIN4257：KPI增加列表维度，以方便自定义KPI使用

### PBIN4269：统一的Web配置和管理中心
