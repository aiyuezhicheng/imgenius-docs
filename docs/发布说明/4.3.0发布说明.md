
import useBaseUrl from '@docusaurus/useBaseUrl';

发布时间：待发布

## 增加的功能

1. [implus-22：Web端库存表支持通过选择作业组来实现库操作](#implus-22web端库存表支持通过选择作业组来实现库操作)
1. [implus-23：优化Web端界面](#implus-23优化web端界面)
1. [implus-24：增加系统角色和粒度更细的权限控制](#implus-24增加系统角色和粒度更细的权限控制)
1. [implus-25：统一的Web配置和管理中心](#implus-25统一的web配置和管理中心)
1. [implus-64：终端支持手册蓝牙秤](#implus-64终端支持手册蓝牙秤)
1. [implus-68：作业组属性显示样式支持可视化配置](#implus-68作业组属性显示样式支持可视化配置)
1. [implus-112：在Windows平台支持同步AD用户](#implus-112在windows平台支持同步ad用户)
1. [implus-114：imFigure页面权限控制](#implus-114imfigure页面权限控制)
1. [implus-115：支持同步用户登录和修改控制](#implus-115支持同步用户登录和修改控制)
1. [implus-124：内置作业组属性报表](#implus-124内置作业组属性报表)
1. [implus-133：终端执行作业项逻辑创建作业，选择资产创建作业，直接点击返回时，不能标记为完成](#implus-133终端执行作业项逻辑创建作业选择资产创建作业直接点击返回时不能标记为完成)
1. [implus-158：EOC的资产详细页面中资产属性为json类型时，点击详细能够查看json属性值](#implus-158eoc的资产详细页面中资产属性为json类型时点击详细能够查看json属性值)
1. [implus-188：把关系引擎配置移植到Web配置里](#implus-188把关系引擎配置移植到web配置里)
1. [implus-214：SDC细节优化](#implus-214sdc细节优化)
1. [implus-222:SDC配置作业组属性每个分组的列头不随滚动条滚动](implus-222sdc配置作业组属性每个分组的列头不随滚动条滚动)
1. [implus-224：为流程活动“插入函数”增加例子](#implus-224为流程活动插入函数增加例子)
1. [implus-250：附件升级为文件库](#implus-250附件升级为文件库)
1. [implus-297：项目甘特图时间宽度修改和增加读取Excel内容的流程后函数类实例](#implus-297项目甘特图时间宽度修改和增加读取excel内容的流程后函数类实例)
1. [implus-361：自定义接口](#implus-361自定义接口)

## 修复的问题

1. implus-20：隐藏的作业项在逻辑值切换后不隐藏，页面不会刷新
1. implus-65：EOC被第三方嵌入，查看JSON字符串的弹窗无法打开
1. implus-79：终端数值，字符串（多行），时间类型作业项输入值没有保存草稿
1. implus-80：自定义KPI，维度-作业组属性-时间为来源时，有错误
1. implus-93：imFigure中，从可导入、下载静态数据的组件切换为无数据源的组件，再切换回来后，也会变成不可导入、下载
1. implus-132：发布计划后修改作业组模板所属组织单元（修改完不发布），计划页面中不可查看的计划就会显示出来
1. implus-134：资产报警配置创建作业，创建出来的作业组名称在计划页面和作业树页面不一致
1. implus-141：通过脚本设置JSON类型作业组属性的值，无法就地显示
1. implus-146：imFigure的项目大屏在安卓盒子中无法显示
1. implus-147：网站设置中已有登录logo或主页顶部logo，保存后再设置网站配置会报错
1. implus-177：EOC中有配置Excel模板的作业项历史报表和资产属性报表、资产历史属性报表等报表，切换表格或Excel模板按钮时，页面无变化
1. implus-182：作业项（历史）报表下载Excel，签名不显示
1. implus-190：EOC查看JSON属性的弹框中，如果有多选列表属性点击表格视图会报错
1. implus-191：组织单元查看权限的配置在库存条目表中没有作用
1. implus-200：作业树页面搜索和高亮功能无效果
1. implus-243：流程中有分支的作业组，在报表中点进作业树界面后，点击返回，报表数据不显示，需刷新才可以
1. implus-246：EOC上我的作业组中，活动实例状态列作为查询条件无法生效
1. implus-247：终端为sqllite数据库，当作业项名称中含有英文问号，导致终端同步出错
1. implus-298：终端库操作，不存在的物料，还能显示数量
1. implus-325：作业组属性中有必填项未填写时，点击完成，提示查看，不会跳转定位到该必填项处
1. implus-345：终端审核页面-作业树中国，摘要信息过滤选择框显示不正确
1. implus-349：作业组属性报表bug
1. implus-350：EOC网站设置中，如果做了选择文件的配置，之后再做其他配置就无法生效
1. implus-351：SDC导入工程时，数据比较大会出现导入不进去
1. implus-352：子项模板下有执行项，在项目详细中引用该子项模板然后删除，该子项模板下的执行项并没有在计划页面一并删除掉。只增加执行项然后删除也是一样
1. implus-354：终端调用接口不要影响离线工作
1. implus-355：EOC的项目甘特图里的时间如果为9999-xx-xx，应视为空
1. implus-356：SDC流程中，条件的线如果是从别的活动改道过来，不会有true/false判断，且验证不会报错，流程也会走不通
1. implus-358：终端主页表格样式视图显示会有阴影遮挡
1. implus-378：项目中的执行项在执行后，其计划开始和结束时间返回不正确
1. implus-403：SDC作业组属性如果存在列表类型的属性，选择其他类型的属性-插入属性时，也会带上列表类型
1. implus-408：EOC审核如果作业组属性值中含有英文单引号会保存失败
1. implus-410：EOC个性设置的配置表格模板中配置$tp.xxx不起作用

## 增加的功能详细说明

### implus-22：Web端库存表支持通过选择作业组来实现库操作

* 在EOC库存表的库操作中，除原有的直接操作外，新增加了以作业组操作。与计划页面一样，勾选即时创建则直接创建，不勾选则为计划。同时也可以修改作业组名称和描述。

  <img alt=" " src={useBaseUrl('docimg/库存表4301.png')} />

* 在SDC作业组模板基本属性中，新增了一个按钮名为“库存工单”，勾选了此项的作业组模板才会出现在库存表以作业组操作的作业组模板列表中。该作业组模板也需要有库存操作的作业组属性。

  <img alt=" " src={useBaseUrl('docimg/库存表4302.png')} />

* 之后，在库存表界面以作业组操作就可以通过编辑库存操作的作业组属性，来完成库操作了，相当于在库存表页面可以直接计划或创建一个库存操作的作业组。

### implus-23：优化Web端界面

* 主页增加待我处理的工作Widget（代办中心），同时增加今日计划和今日作业组Widget。

  <img alt=" " src={useBaseUrl('docimg/主页4301.png')} />

* 管理导航时，人员可选择超级管理员。

  <img alt=" " src={useBaseUrl('docimg/导航4301.png')} />

* 计划显示时，如果某个计划已归档，则计划头部颜色固定为深绿色。

  <img alt=" " src={useBaseUrl('docimg/计划4301.png')} />

* 计划选择作业组模板时，如果右边有筛选，则只能选择这些已选中的作业组模板。

  <img alt=" " src={useBaseUrl('docimg/计划4302.png')} />

### implus-24：增加系统角色和粒度更细的权限控制

* 在Web配置和管理中心-系统中，新增了系统角色的配置，在web配置中进行配置后，可以在Web配置和管理中心的用户基本属性或SDC的用户基本属性中，为用户选择配置好的系统角色，以此来控制用户在Web配置和管理中心里的权限。（注意：目前EOC和终端，目前不受此权限控制，后续会进行整合。）

  <img alt=" " src={useBaseUrl('docimg/系统角色4301.png')} />

* 如图，新建并配置了一个名为只有岗位的系统角色。

  <img alt=" " src={useBaseUrl('docimg/系统角色4302.png')} />

* 之后在Web配置的组织架构-用户，选择一个用户点击编辑，或者SDC组织架构管理器的用户中选择一个用户，为其选择上系统角色。

  <img alt=" " src={useBaseUrl('docimg/系统角色4303.png')} />

  <img alt=" " src={useBaseUrl('docimg/系统角色4304.png')} />

* 最后用该用户登录EOC，进入Web配置和管理中心，可以看到该用户只能对岗位菜单进行查看和编辑等操作了。

  <img alt=" " src={useBaseUrl('docimg/系统角色4305.png')} />

### implus-25：统一的Web配置和管理中心

* Web配置和管理中心进一步升级优化，将更多的SDC配置功能Web化。

* 左侧菜单新增加了作业管理，系统-系统角色，和高级。作业管理中包括作业组模板、作业规范和项目模板。系统-系统角色中，可以进行粒度更细的权限控制。高级中，将关联关系引擎移植了过来，无需进行额外的配置。

* 功能上增加了拷贝ID、Excel的导入导出、整个工程的导入导出、对于各实体基本属性的编辑等等。另外作业管理-作业组模板中增加了Web端才可以进行配置的自定义表单功能，用来对作业组属性的显示样式进行自定义配置。

  <img alt=" " src={useBaseUrl('docimg/web配置4301.png')} />

### implus-64：终端支持手册蓝牙秤

* 终端在支持蓝牙电子秤功能升级，支持新设备的数据格式。

  <img alt=" " src={useBaseUrl('docimg/蓝牙秤4301.png')} />

* 升级后的区别

  <img alt=" " src={useBaseUrl('docimg/蓝牙秤4302.png')} />

### implus-68：作业组属性显示样式支持可视化配置

* 在Web配置和管理中心-作业管理-作业组模板中，新增了自定义表单功能，此功能并不是表单模式的增强，而是可以自定义作业组属性在EOC和终端上的显示样式，并且可以较为简单的去配置出在SDC里无法配置的或配置起来很复杂的需求。

* 首先，SDC里已经建好了作业组属性后，在EOC上点进Web配置和管理中心-作业管理-作业组模板，可以看到自定义表单选项，点击进入自定义表单配置页面。

  <img alt=" " src={useBaseUrl('docimg/自定义表单4301.png')} />

  <img alt=" " src={useBaseUrl('docimg/自定义表单4302.png')} />

* 在自定义表单页面，点击重置，就会将SDC里的作业组属性同步过来，之后就可以开始配置其显示样式了。

* 页面左侧为各种组件，不点击重置，自行拖动各种组件来对应作业组属性也是可以的。右侧为配置栏，可以设置必填、隐藏、禁用等，可以写各类脚本，写法与SDC中略有差异，同时也可以配置显示的格式样式。其中属性名栏，如果是自行拖动组件来配置的话，其值必须填写与SDC中作业组属性名一样。

* 如图，配置的样式为，将“未完成原因”和“人员”这两个属性默认为隐藏且“未完成原因”为必填，当“是否完成”的值为“否”时，才会显示出来，并且必填才会生效。

  <img alt=" " src={useBaseUrl('docimg/自定义表单4303.png')} />

* 想要实现这个效果，除了配置完“未完成原因”和“人员”外，只需要在“是否完成”中写一个数据修改后脚本即可，脚本窗口右侧内置有几种脚本的写法。

  <img alt=" " src={useBaseUrl('docimg/自定义表单4304.png')} />

* 配置完保存之后，在SDC的作业组基本属性框-自定义报表处，会自动生成一个表单的值，有这个值，那么该作业组就会显示自定义表单样式，删除掉这个值，就显示为原样式。

  <img alt=" " src={useBaseUrl('docimg/自定义表单4306.png')} />

* 在计划页面的实际效果。

  <img alt=" " src={useBaseUrl('docimg/自定义表单4305.gif')} />

* 数据格式为Json的属性，默认有两种显示样式，可以自由切换，一种为常规列表样式，一种为表格列表样式。

  <img alt=" " src={useBaseUrl('docimg/自定义表单4307.gif')} />

### implus-112：在Windows平台支持同步AD用户

### implus-114：imFigure页面权限控制

* imFigure页面权限控制增强，页面的登录权限与当前登录人员的EOC端权限一致，页面中的新建、编辑、查看和删除等权限，由Web配置和管理中心-系统中的系统角色资源权限来决定，包括大屏盒子和项目大屏。

  <img alt=" " src={useBaseUrl('docimg/imFigure4301.png')} />
  <img alt=" " src={useBaseUrl('docimg/imFigure4302.png')} />

### implus-115：支持同步用户登录和修改控制

### implus-124：内置作业组属性报表

* 将作业组属性报表内置到了报表当中，省去了自定义配置的步骤，直接在作业组属性报表中勾选作业组和作业组属性就可以直接展示出来。原本的在系统扩展管理中添加自定义xml文件的方式也依然支持。

  <img alt=" " src={useBaseUrl('docimg/作业组属性报表4301.png')} />

### implus-133：终端执行作业项逻辑创建作业，选择资产创建作业，直接点击返回时，不能标记为完成

* 终端作业项创建作业功能优化，现在触发创建作业逻辑，若不选择资产，直接返回的作业组，不能标记为完成。返回则直接退出执行页面，再次进入时，会重新要求选择资产，选择了才可以继续执行。

  <img alt=" " src={useBaseUrl('docimg/终端创建作业4301.gif')} />

### implus-158：EOC的资产详细页面中资产属性为json类型时，点击详细能够查看json属性值

* 在EOC端，资产总览中，当资产属性为json类型时，点击详细，可以查看到json属性值。

  <img alt=" " src={useBaseUrl('docimg/资产总览4301.png')} />

### implus-188：把关系引擎配置移植到Web配置里

* 将关系引擎的配置，直接移植到了Web配置中，部署包中不再包含关系引擎包（RelationEngine），部署工具里也去掉了包含关系引擎的选项。只要部署了Web配置，然后在系统扩展管理-自定义报表-内置扩展中添加配置与管理中心，之后在Web配置和管理中心页面的高级中，就可以看到关系引擎编辑器。

  <img alt=" " src={useBaseUrl('docimg/关系引擎4301.png')} />

  <img alt=" " src={useBaseUrl('docimg/关系引擎4302.png')} />

  <img alt=" " src={useBaseUrl('docimg/关系引擎4303.png')} />

### implus-214：SDC细节优化

* 作业规范发布与未发布的颜色不好区分，改为更明显的颜色。现在与作业组中发布和未发布的颜色保持一致。

  <img alt=" " src={useBaseUrl('docimg/SDC4301.png')} />

* 允许作业组流程中不配置计划和创建活动，以方便按需创建的作业组的配置和验证。

  <img alt=" " src={useBaseUrl('docimg/SDC4306.png')} />

* json的数据格式配置不显示。如果是库操作类型，显示已配置为库操作；如果是json数组类型，显示已配置为Json数组；如果是json类型，显示为已配置为Json对象。

  <img alt=" " src={useBaseUrl('docimg/SDC4302.png')} />

* 默认的作业组分组、作业规范分组、附件中的语音提示，内置到所有解决方案模板中。

  <img alt=" " src={useBaseUrl('docimg/SDC4303.png')} />
  <img alt=" " src={useBaseUrl('docimg/SDC4304.png')} />

* 去掉资产号旁的读取和写入按钮。

  <img alt=" " src={useBaseUrl('docimg/SDC4305.png')} />

* 作业项逻辑创建作业规范和按需创建时增加提示。当配置作业项创建作业逻辑时，如果选择的作业规范没有勾选终端按需创建，会在选择后弹出在终端无法创建的提示。

  <img alt=" " src={useBaseUrl('docimg/SDC4307.png')} />

### implus-222:SDC配置作业组属性每个分组的列头不随滚动条滚动

* 在SDC中配置作业组属性时，每个分组的列头可以不随滚动条滚动，锁定起来方便流程活动实例权限的配置，类似于excel的首行冻结。

  <img alt=" " src={useBaseUrl('docimg/SDC4308.png')} />

### implus-224：为流程活动“插入函数”增加例子

* 在SDC流程活动的属性-活动结束事件-插入函数中，选择了某个流程后函数之后，在该函数的简单说明框中，除原有的函数原型、类和描述外，为每个流程后函数的说明增加了例子，方便更好的理解流程后函数的作用及使用。

  <img alt=" " src={useBaseUrl('docimg/业务流程4301.png')} />

### implus-250：附件升级为文件库

* 附件功能升级，在EOC端增加文件库功能，可以对附件进行类别专业系统形式的分级分类属性管理。

  <img alt=" " src={useBaseUrl('docimg/文件库4301.png')} />

* 在管理分类中，可以配置附件可选的分级和分类

  <img alt=" " src={useBaseUrl('docimg/文件库4302.png')} />

* 上传中可以选择附件上传，并为其配置分级分类属性，可选该附件上传后是否允许下载，是否加密该文件，当有同名附件时可选择覆盖或跳过。

  <img alt=" " src={useBaseUrl('docimg/文件库4303.png')} />

* 下载按钮可以下载当前页面附件目录的excel，同时也支持配置查询条件。

* 此外，每个附件都可以单独进行下载、删除、编辑属性和重命名。

### implus-297：项目甘特图时间宽度修改和增加读取Excel内容的流程后函数类实例

* 项目中时间宽度和排程优化，执行项会按照归档时间排程，自动排程会参考当前时间，如果小于当前时间时，起点会变为为当前时间+5分钟。

* 增加了读取Excel内容的流程后函数类实例，可以从作业组文件属性中读取Excel内容，设置给例如下图中出库的操作项

  <img alt=" " src={useBaseUrl('docimg/流程后脚本4301.png')} />

* 脚本内容如下：

```js
// 从作业组文件属性中读取Excel内容，设置给出库的操作项
var taskGroupID = curTaskGroup.ID;
// 获取作业组属性
var getProperty = function (_propertyName) {
    var property = null;
    var url = 'Report/GetTaskGroupPropertyByName?taskGroupID=' + taskGroupID + '&name=' + _propertyName;
    var result = imClient.Get(url);
    var resultObj = JSON.parse(result);
    if (resultObj) {
        if (resultObj.IsOk) {
            property = resultObj.Response;
            imLogWriter.WriteError('获取作业组属性 ' + _propertyName + ' 调用成功，返回数据为：' + JSON.stringify(property));
        }
        else {
            imLogWriter.WriteError('获取作业组属性 ' + _propertyName + ' 调用成功，但返回错误，错误信息为：' + resultObj.ErrorMsg);
        }
    }
    else {
        imLogWriter.WriteError('获取作业组属性 ' + _propertyName + ' 调用失败，返回为：' + result);
    }
    return property;
};
// 获取作业组文件属性Excel文件内容
var getExcelContent = function (_propertyName) {
    var list = null;
    var content = excelTool.ReadByTaskGroupProperty(taskGroupID, _propertyName, false);
    if (content) {
        list = JSON.parse(content);
    }
    else {
        imLogWriter.WriteError('从作业组文件属性 ' + _propertyName + ' 读取到的Excel内容为空');
    }
    return list;
};
// 保存作业组属性值
var savePropertyValue = function (_propertyName, _value) {
    var success = false;
    var url = 'Report/ModifyTaskGroupPropertyValueByName?id=' + taskGroupID + '&propertyName=' + _propertyName + '&value=' + _value;
    var result = imClient.Put(url);
    var resultObj = JSON.parse(result);
    if (resultObj) {
        if (resultObj.IsOk) {
            imLogWriter.WriteError('修改作业组属性 ' + _propertyName + ' 调用成功，返回数据为：' + JSON.stringify(resultObj.Response));
            success = true;
        }
        else {
            imLogWriter.WriteError('修改作业组属性 ' + _propertyName + ' 调用成功，但返回错误，错误信息为：' + resultObj.ErrorMsg);
        }
    }
    else {
        imLogWriter.WriteError('修改作业组属性 ' + _propertyName + ' 调用失败，返回为：' + result);
    }
    return success;
};
var list = getExcelContent('BOM清单文件');
if (list && list.length > 0) {
    var property = getProperty('领料');
    if (property) {
        var pvObj = null;
        if (property.Value) {
            pvObj = JSON.parse(property.Value);
        }
        if (!pvObj) {
            pvObj = { '来源存储区域': '', '操作项': [], '存放位置': '' };
        }
        var operaList = [];
        for (var i = 0; i < list.length; i++) {
            var item = {
                '物料': list[i]['编号'],
                '数量': list[i]['数量'],
                '单位': list[i]['单位']
            };
            operaList.push(item);
        }
        pvObj['操作项'] = operaList;
        savePropertyValue('领料', JSON.stringify(pvObj));
    }
}
```

### implus-361：自定义接口

* 从4.3.0开始，使用新的RESTful API接口，接口帮助的网站访问地址由原来的`http://localhost:8010`变为`http://localhost:8010/swagger/index.html`，仍然是通过部署工具部署imMsg压缩包到指定位置，另外SMC设置中填写的消息系统内外网的访问网址也不变还是`http://localhost:8010`和`http://ip地址:8010`。

  <img alt=" " src={useBaseUrl('docimg/接口4301.png')} />
